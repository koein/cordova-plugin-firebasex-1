<?xml version='1.0' encoding='utf-8'?>
<plugin id="cordova-plugin-firebasex" version="19.0.1"
    xmlns="http://apache.org/cordova/ns/plugins/1.0"
    xmlns:android="http://schemas.android.com/apk/res/android">

    <name>Google Firebase Plugin (Lite)</name>

    <engines>
        <engine name="cordova" version=">=12" />
        <engine name="cordova-android" version=">=14" />
        <engine name="cordova-ios" version=">=7 || 8.0.0-beta.1" />
    </engines>

    <!-- Firebase Flags -->
    <preference name="FIREBASE_ANALYTICS_COLLECTION_ENABLED" default="true" />
    <preference name="FIREBASE_CRASHLYTICS_COLLECTION_ENABLED" default="true" />
    <preference name="FIREBASE_FCM_AUTOINIT_ENABLED" default="true" />
    <preference name="FIREBASE_MESSAGING_IMMEDIATE_PAYLOAD_DELIVERY" default="false" />

    <!-- ANDROID (no changes required for your issue) -->
    <platform name="android">

        <js-module name="FirebasePlugin" src="www/firebase.js">
            <clobbers target="FirebasePlugin" />
        </js-module>

        <config-file target="config.xml" parent="/*">
            <preference name="GradlePluginGoogleServicesEnabled" value="true" />
        </config-file>

        <config-file parent="/*" target="res/xml/config.xml">
            <preference name="FIREBASE_MESSAGING_IMMEDIATE_PAYLOAD_DELIVERY" value="$FIREBASE_MESSAGING_IMMEDIATE_PAYLOAD_DELIVERY" />
            <feature name="FirebasePlugin">
                <param name="android-package" value="org.apache.cordova.firebase.FirebasePlugin" />
                <param name="onload" value="true" />
            </feature>
        </config-file>

        <!-- Core required libs only -->
        <framework src="com.google.firebase:firebase-analytics:23.0.0" />
        <framework src="com.google.firebase:firebase-messaging:25.0.1" />
        <framework src="com.google.firebase:firebase-crashlytics:20.0.2" />

    </platform>

    <!-- ======================= -->
    <!--      iOS PLATFORM       -->
    <!-- ======================= -->

    <platform name="ios">

        <hook type="before_plugin_install" src="scripts/ios/before_plugin_install.js" />
        <hook type="after_plugin_install" src="scripts/ios/after_plugin_install.js" />
        <hook type="before_plugin_uninstall" src="scripts/ios/before_plugin_uninstall.js" />

        <preference name="IOS_FCM_ENABLED" default="true" />

        <js-module name="FirebasePlugin" src="www/firebase.js">
            <clobbers target="FirebasePlugin" />
        </js-module>

        <config-file target="config.xml" parent="/*">
            <feature name="FirebasePlugin">
                <param name="ios-package" value="FirebasePlugin" />
                <param name="onload" value="true" />
            </feature>
        </config-file>

        <resource-file src="src/ios/GoogleService-Info.plist" />

        <header-file src="src/ios/AppDelegate+FirebasePlugin.h" />
        <source-file src="src/ios/AppDelegate+FirebasePlugin.m" />
        <header-file src="src/ios/FirebasePlugin.h" />
        <source-file src="src/ios/FirebasePlugin.m" />
        <header-file src="src/ios/FirebaseWrapper.h" />
        <header-file src="src/ios/FirebasePluginMessageReceiver.h" />
        <source-file src="src/ios/FirebasePluginMessageReceiver.m" />
        <header-file src="src/ios/FirebasePluginMessageReceiverManager.h" />
        <source-file src="src/ios/FirebasePluginMessageReceiverManager.m" />

        <framework src="AuthenticationServices.framework" />

        <!-- CLEAN PODSPEC -->
        <podspec>
            <config>
                <source url="https://cdn.cocoapods.org/" />

                <pod_target_xcconfig>
                    <IPHONEOS_DEPLOYMENT_TARGET>16.0</IPHONEOS_DEPLOYMENT_TARGET>
                </pod_target_xcconfig>

                <user_target_xcconfig>
                    <IPHONEOS_DEPLOYMENT_TARGET>16.0</IPHONEOS_DEPLOYMENT_TARGET>
                </user_target_xcconfig>
            </config>

            <podfile>
                <header>
                    platform :ios, '16.0'
                </header>
            </podfile>

            <pods use-frameworks="true">

                <!-- REQUIRED -->
                <pod name="FirebaseCore" spec="12.3.0"/>
                <pod name="FirebaseAnalytics" spec="12.3.0"/>
                <pod name="FirebaseAnalytics/IdentitySupport" spec="12.3.0"/>
                <pod name="FirebaseMessaging" spec="12.3.0"/>
                <pod name="FirebaseCrashlytics" spec="12.3.0"/>

                <!-- NO OPTIONAL MODULES -->
                <!-- All removed -->

            </pods>

        </podspec>

    </platform>

    <hook type="after_prepare" src="scripts/after_prepare.js" />

</plugin>
